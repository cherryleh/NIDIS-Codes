<!DOCTYPE html>
<html>
    <head>
               <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
               <script src="http://code.jquery.com/jquery-latest.js"></script>

    </head>

    <body>
        <div id='myDiv1'></div>
        <div id='myDiv2'></div>
        <script>
            /*var trace1 = {
              x: [0, 1, 2, 3, 4, 5],
              y: [1.5, 1, 1.3, 0.7, 0.8, 0.9],
              type: 'scatter'
            };

            var trace2 = {
              x: [0, 1, 2, 3, 4, 5],
              y: [1, 0.5, 0.7, -1.2, 0.3, 0.4],
              type: 'bar'
            };

            var data = [trace1, trace2];

            Plotly.newPlot('myDiv', data);*/

            //sources: 
            //
            //calls of csv files: get csv data: https://plot.ly/javascript/ajax-call/
            // handling various csv s https://community.plot.ly/t/how-to-merge-two-plotly-graphs-plotted-by-using-rest-url-for-csv-data/2122
            //
            // Range slider and time selectors: https://plot.ly/javascript/range-slider/
            //
            //Resonsive layout: 
            //https://plot.ly/javascript/responsive-fluid-layout/
            //https://codepen.io/etpinard/pen/NrrOrY?editors=1010 (responsive resize)
            //
            //https://plot.ly/javascript/plotlyjs-function-reference/
            //
            // layout axis: https://plot.ly/javascript/multiple-axes/
            //
            // add traces function: https://plot.ly/javascript/plotlyjs-function-reference/


        </script>


<script>
    var url1 = 'https://raw.githubusercontent.com/cherryleh/testcsvs/main/RS04-ET.csv';
    var x1SeriesName = 'datetime';
    var y1SeriesName = 'ET';
    var y1NameToBeDisplayed = 'ET';
    var y1Mode = 'lines';


    var url2 = 'https://raw.githubusercontent.com/cherryleh/testcsvs/main/RS04-ndvi.csv';
    var x2SeriesName = 'datetime';
    var y2SeriesName = 'NDVI';
    var y2NameToBeDisplayed = 'NDVI';
    var y2Mode = 'lines';


    //var url3 = 'XXXX';
    //var url4 = 'XXXX';
    //var url5 = 'XXXX';


    // Section deals with buttons for time range selection
    var selectorOptions = {
      buttons: [{
        step: 'month',
        stepmode: 'backward',
        count: 1,
        label: '1m'
      }, {
        step: 'month',
        stepmode: 'backward',
        count: 6,
        label: '6m'
      }, {
        step: 'year',
        stepmode: 'todate',
        count: 1,
        label: 'YTD'
      }, {
        step: 'year',
        stepmode: 'backward',
        count: 1,
        label: '1y'
      }, {
        step: 'all',
      }],
    };

    // set layout down here
    var layout = {
      xaxis: {
        rangeselector: selectorOptions,
        rangeslider: {}
      },
      yaxis: {
        fixedrange: true,
        side: 'right'
      },
      showlegend: false
    };

    // set display options
    var options ={
      showLink: false,
      displayModeBar: false
    };

    // Next piece of code deals with responsiveness
    var d3 = Plotly.d3;
    var WIDTH_IN_PERCENT_OF_PARENT = 100,
      HEIGHT_IN_PERCENT_OF_PARENT = 97;

    var gd3_div1 = d3.select("div[id='myDiv1']")
      .style({
        width: WIDTH_IN_PERCENT_OF_PARENT + '%',
        'margin-left': (100 - WIDTH_IN_PERCENT_OF_PARENT) / 2 + '%',
        height: HEIGHT_IN_PERCENT_OF_PARENT + 'vh',
        'margin-top': (100 - HEIGHT_IN_PERCENT_OF_PARENT) / 2 + 'vh'
      });
  
    var gd3_div2 = d3.select("div[id='myDiv2']")
      .style({
        width: WIDTH_IN_PERCENT_OF_PARENT + '%',
        'margin-left': (100 - WIDTH_IN_PERCENT_OF_PARENT) / 2 + '%',
        height: HEIGHT_IN_PERCENT_OF_PARENT + 'vh',
        'margin-top': (100 - HEIGHT_IN_PERCENT_OF_PARENT) / 2 + 'vh'
      });

    var my_Div1 = gd3_div1.node();
    var my_Div2 = gd3_div2.node();


    //URL1 and URL2
    function makeplot() {
      Plotly.d3.csv(url1, function(data){ processData(data,x1SeriesName,y1SeriesName,y1NameToBeDisplayed, y1Mode, "myDiv1") } );
      Plotly.d3.csv(url2, function(data){ processData(data,x2SeriesName,y2SeriesName,y2NameToBeDisplayed, y2Mode, "myDiv2") } );
    };

    function processData(allRows,xLabel,yLabel,yTraceName, yMode, divName) {

      console.log(allRows.length);
      var x = [], y = [];

      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
 
        x.push(row[xLabel]);
        y.push(row[yLabel]);
        if(i === 0) {
          console.log(i);
          console.log(row);
        }
      }
      makePlotly( x, y,  yTraceName, yMode, divName);
    }

    function makePlotly( x, y, yTraceName, yMode, divName){
      var traces = [{
        x: x,
        y: y,
        name: yTraceName,
        type: yMode,
      }];

      Plotly.newPlot(divName,traces,layout,options);
    };

    makeplot();

    //instruction resizes plot
    window.onresize = function() {
      Plotly.Plots.resize(my_Div1);
      Plotly.Plots.resize(my_Div2);
    };

</script>
    </body>
</html>